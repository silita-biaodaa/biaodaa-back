<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.silita.dao.TbNtMianMapper">

    <select id="listNtMain" parameterType="com.silita.model.TbNtMian" resultType="Map">
        SELECT `pkid`, `title`, `pub_date` AS pubDate, `src_site` AS srcSite, `nt_status` AS ntStatus
        FROM ${tableName}
        WHERE 1=1
        <if test="proviceCode !=null and proviceCode!=''">
            AND provice_code = #{proviceCode}
        </if>
        <if test="cityCode !=null and cityCode!=''">
            AND city_code = #{cityCode}
        </if>
        <if test="countyCode !=null and countyCode!=''">
            AND county_code = #{countyCode}
        </if>
        <if test="pubDate !=null and pubDate!=''">
            AND pub_date &gt;= #{pubDate}
        </if>
        <if test="pubEndDate !=null and pubEndDate!=''">
            AND pub_date &lt;= #{pubEndDate}
        </if>
        <if test="title !=null and title!=''">
            AND title LIKE CONCAT('%', #{title}, '%')
        </if>
        <if test="ntCategory !=null and ntCategory!=''">
            AND nt_category = #{ntCategory}
        </if>
        <choose>
            <when test="ntStatus =='3' or ntStatus ==3">
                AND nt_status != 2
            </when>
            <when test="ntStatus !=null and ntStatus!=''">
                AND nt_status = #{ntStatus}
            </when>
            <otherwise>
            </otherwise>
        </choose>
        ORDER BY pub_date DESC
        LIMIT #{start}, #{pageSize}
    </select>

    <select id="countNtMian" parameterType="com.silita.model.TbNtMian" resultType="Integer">
        SELECT COUNT(*)
        FROM ${tableName}
        WHERE 1=1
        <if test="proviceCode !=null and proviceCode!=''">
            AND provice_code = #{proviceCode}
        </if>
        <if test="cityCode !=null and cityCode!=''">
            AND city_code = #{cityCode}
        </if>
        <if test="countyCode !=null and countyCode!=''">
            AND county_code = #{countyCode}
        </if>
        <if test="pubDate !=null and pubDate!=''">
            AND pub_date &gt;= #{pubDate}
        </if>
        <if test="pubEndDate !=null and pubEndDate!=''">
            AND pub_date &lt;= #{pubEndDate}
        </if>
        <if test="title !=null and title!=''">
            AND title LIKE CONCAT('%', #{title}, '%')
        </if>
        <if test="ntCategory !=null and ntCategory!=''">
            AND nt_category = #{ntCategory}
        </if>
        <choose>
            <when test="ntStatus =='3' or ntStatus ==3">
                AND nt_status != 2
            </when>
            <when test="ntStatus !=null and ntStatus!=''">
                AND nt_status = #{ntStatus}
            </when>
            <otherwise>
            </otherwise>
        </choose>
    </select>

    <delete id="deleteNtMainByPkId" parameterType="com.silita.model.TbNtMian">
        DELETE FROM ${tableName} WHERE pkid = #{pkid}
    </delete>

    <update id="updateNtMainCategoryAndStatusByPkId" parameterType="com.silita.model.TbNtMian">
        UPDATE ${tableName} SET
        <if test="ntCategory !=null and ntCategory!=''">
            `nt_category` = #{ntCategory},
        </if>
        <if test="ntStatus !=null and ntStatus!=''">
            `nt_status` = #{ntStatus},
        </if>
        `updated` = NOW()
        WHERE pkid = #{pkid}
    </update>
</mapper>