<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.silita.dao2.ZhaobiaoDetailOthersMapper" >
  <resultMap id="BaseResultMap" type="com.silita.model.ZhaobiaoDetailOthers" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="snatchUrlId" property="snatchUrlId" jdbcType="INTEGER" />
    <result column="projName" property="projName" jdbcType="VARCHAR" />
    <result column="block" property="block" jdbcType="VARCHAR" />
    <result column="gsDate" property="gsDate" jdbcType="VARCHAR" />
    <result column="projDq" property="projDq" jdbcType="VARCHAR" />
    <result column="projXs" property="projXs" jdbcType="VARCHAR" />
    <result column="pbMode" property="pbMode" jdbcType="VARCHAR" />
    <result column="source" property="source" jdbcType="VARCHAR" />

    <!-- 资质 -->
    <collection property="snatchUrlCerts" ofType="com.silita.model.SnatchUrlCert">
      <id column="s_id" property="id" jdbcType="INTEGER" />
      <result column="contId" property="contId" jdbcType="INTEGER" />
      <result column="certificate" property="certificate" jdbcType="VARCHAR" />
      <result column="certificateUuid" property="certificateUuid" jdbcType="VARCHAR" />
      <result column="licence" property="licence" jdbcType="VARCHAR" />
      <result column="type" property="type" jdbcType="VARCHAR" />
      <result column="s_block" property="block" jdbcType="VARCHAR" />
      <result column="s_source" property="source" jdbcType="VARCHAR" />
    </collection>
  </resultMap>


  <select id="listZhaobiaoDetailOthersBySnatchUrlId" parameterType="com.silita.model.ZhaobiaoDetailOthers" resultMap="BaseResultMap">
    SELECT zhaobiao.id, main.id AS snatchUrlId, main.title AS projName, zhaobiao.block, zhaobiao.projDq, zhaobiao.projXs,
    zhaobiao.pbMode , main.openDate AS gsDate, main.source,
    cert.id AS s_id, cert.contId, cert.certificate, cert.certificateUuid, cert.licence,
    cert.type , cert.block AS s_block, cert.source AS s_source
    FROM mishu.snatchurl_${source} main
    LEFT JOIN mishu.zhaobiao_detail_others zhaobiao ON main.`id` = zhaobiao.`snatchUrlId` AND main.`source` = zhaobiao.`source`
    LEFT JOIN mishu.snatch_url_cert_others cert ON zhaobiao.`snatchUrlId` = cert.`contId` AND zhaobiao.`source` = cert.`source`
    WHERE main.`id` = #{snatchUrlId} AND main.`source` = #{source}
  </select>

  <update id="updateZhaobiaoDetailOthersById" parameterType="com.silita.model.ZhaobiaoDetailOthers">
    UPDATE mishu.zhaobiao_detail_others SET
    <if test="projName != null and projName != ''">
      `projName` = #{projName},
    </if>
    <if test="block != null and block != ''">
      `block` = #{block},
    </if>
    `projDq` = #{projDq},
    `projXs` = #{projXs},
    `pbMode` = #{pbMode}
    WHERE `id` = #{id}
  </update>

</mapper>